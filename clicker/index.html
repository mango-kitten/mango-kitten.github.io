<!DOCTYPE html>
<html>
  <head>
    <title>MangoKitten Clicker</title>
      <link rel="stylesheet" href="../style.css">
      <link rel="preconnect" href="https://fonts.googleapis.com">
      <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
      <link href="https://fonts.googleapis.com/css2?family=Playpen+Sans&display=swap" rel="stylesheet">
      <link rel="icon" type="image/x-icon" href="../img/favicon.ico">
  </head>
  <body onload="autoload()">
    <header>
      <p class="spacer">&#10240</p>
      <h1>MangoKitten</h1>
      <p class="spacer">&#10240</p>
    </header>
    <main>
      <script src="scripts/essentials.js"></script>
      <script>
        // preloading and restoration
        let dolor = parseInt(localStorage.getItem("money"));
        let mpc = parseInt(localStorage.getItem("mpc"));
        let cats = localStorage.getItem("cats");
        let bought = [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0];
        let iscat1 = 0;
        if (mpc == 1) {
          bought = [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0];
        } else {
          var str = localStorage.getItem("bought");
          if (str.includes("[")) {
            str = str.substring(1, str.length - 1); // cut out the brackets
          }
          bought = str.split(",");
          console.log(bought)
        }
        if (cats) {
          var str = localStorage.getItem("cats");
          if (str.includes("[")) {
            str = str.substring(1, str.length - 1); // cut out the brackets
          }
          cats = str.split(",");
          console.log(cats)
        } else {
          cats = [0, 0, 0, 0, 0, 0, 0, 0, 0, 0]
        }

        // define arrays for buying stuff
        let max = [1, 6, 8, 8, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0];
        let costs = [2000, 50, 1000, 10000, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0];
        let itemprice = 0;

        if (!dolor) {
          dolor = 0;
          console.log("No save file found, starting fresh.")
        }
        if (isNaN(dolor)) {
          resetstorage();
          console.log("dolor = NaN")
          dolor = 0;
          console.log("No save file found, starting fresh.")
        }
        if (!mpc) {
          mpc = 1;
        }
        if (isNaN(mpc)) {
          console.log("mpc = NaN")
          resetstorage();
          mpc = 1;
        }
        if (!bought) {
          bought = [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0];
        }

        // continue preload once html elements exist
        function autoload() {
          updatetext();
          console.log("Loaded")
        }

        // get money
        function money() {
          dolor = dolor + mpc
          document.getElementById("moneydisp").innerHTML = `Money: ${String(dolor)}`
        }
        // manual save
        function localsave() {
          localStorage.setItem("money", dolor);
          localStorage.setItem("mpc", mpc);
          localStorage.setItem("bought", bought);
          localStorage.setItem("cats", cats)
          var now = new Date();
          var datetime = now.toLocaleString();
          document.getElementById("lastsaved").innerHTML = `Last Saved: ${String(datetime)}`
          console.log("Saved")
          updatetext();
        }
        // manual load
        function localload() {
          let dolor = parseInt(localStorage.getItem("money"));
          let mpc = parseInt(localStorage.getItem("mpc"));
          let bought = localStorage.getItem("bought");
          let cats = localStorage.getItem("cats");
          console.log("Loaded")
          updatetext();
        }
        // manual hard reset
        function resetstorage() {
          dolor = 0;
          localStorage.setItem("money", 0);
          mpc = 1;
          localStorage.setItem("mpc", 1);
          bought = [0, 0, 0, 0];
          localStorage.setItem("bought", [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0]);
          cats = [0, 0, 0, 0, 0, 0, 0, 0, 0, 0]
          catgot1 = 0
          localStorage.setItem("cats", [0, 0, 0, 0, 0, 0, 0, 0, 0, 0]);
          document.getElementById("moneydisp").innerHTML = `Money: ${String(dolor)}`
          document.getElementById("mpcdisp").innerHTML = `Money per Click: ${String(mpc)}`
          updatetext();
        }

        // buy an item off the above arrays
        function buyitem(id) {
          itemprice = costs[id];
          itemqty = bought[id];
          itemmax = max[id];
          if (parseInt(itemqty) < itemmax) {
            if (dolor >= itemprice) {
              dolor = dolor-itemprice;
              if (id == 0) {
                bought.splice(0, 1, parseInt(itemqty)+1)
                document.getElementById("money").innerHTML = `Get Money üêà`
                updatetext();
              } else if (id == 1) {
                mpc = mpc + 0.5;
                bought.splice(1, 1, parseInt(itemqty)+1)
                updatetext();
              } else if (id == 2) {
                bought.splice(2, 1, parseInt(itemqty)+1)
                mpc = mpc + 2;
                updatetext();
              } else if (id == 3) {
                bought.splice(3, 1, parseInt(itemqty)+1)
                mpc = mpc + 10;
                updatetext();
              }
              document.getElementById("clickerinfo").innerHTML = "---"
              // bought item
            } else {
              // too poor
              document.getElementById("clickerinfo").innerHTML = "You're too poor!"
            };
          } else {
            document.getElementById("clickerinfo").innerHTML = "You already have the max!"
          }
        };
        
        // autosave
        setInterval(function() {
          localStorage.setItem("money", dolor);
          localStorage.setItem("mpc", mpc);
          localStorage.setItem("bought", bought);
          localStorage.setItem("cats", cats)
          var now = new Date();
          var datetime = now.toLocaleString();
          document.getElementById("lastsaved").innerHTML = `Last Saved: ${String(datetime)}`
          console.log("Auto-saved")
        }, 60 * 1000);
      </script>
      <div class="spacer">
        <p>&#10240</p>
      </div>
      <div class="topbar">
        <p id="clickertopbar">Mangos Clicker Game v0.4.1</p>
      </div>
      <div class="savemenu">
        <button onclick="localsave()" class="savebutton">Save</button>
        <button onclick="localload()" class="savebutton">Load</button>
        <button onclick="resetstorage()" class="resetbutton">Reset</button>
        <p id="lastsaved">Last Saved: Not saved this session.</p>
      </div>
      <div class="interface">
        <h2 id="moneydisp">Money: 0</h2>
        <p id="mpcdisp">Money per Click: 1</p>
        <button onclick="money()" class="moneybutton" id="money">Get Money</button>
      </div>
      <div class="spacer">
        <p>&#10240</p>
        <p>&#10240</p>
      </div>
      <div class="shop">
        <button onclick="buyitem(0)" class="buybutton" id="cat1">Buy a Cat $2000 (0/1)</button>
        <button onclick="buyitem(1)" class="buybutton" id="mpc1">Increase mpc $50 (0/6)</button>
        <button onclick="buyitem(2)" class="buybutton" id="mpc2">Mpc lv 2 $1000 (0/8)</button>
        <button onclick="buyitem(3)" class="buybutton" id="mpc3">Mpc lv 3 $10000 (0/8)</button>
        <p id="clickerinfo">---</p>
      </div>
      <div class="spacer">
        <p>&#10240</p>
        <p>&#10240</p>
        <p>&#10240</p>
      </div>

      <div class="catstorage">
        <p>Adopt more cats, get more money!!!!!!</p>
        <p id="cat1error">---</p>
        <button onclick="buyCatSet1()" class="buybutton" id="getc1">Find a Stray ($500)</button>
        <p id="catres1">No cats recently found</p>
        <button onclick="keepCat1()" class="keepbutton" id="keepc1">Adopt</button>
        <button onclick="releaseCat1()" class="replacebutton" id="releasec1">Release</button>
        <p id="catown1">You have no cat in slot 1</p>
      </div>

      <div class="spacer">
        <p>&#10240</p>
        <p>&#10240</p>
        <p>&#10240</p>
        <p>&#10240</p>
      </div>

      <div class="changelog">
        <h2>Changelog:</h2>
        <p>v0.4.1<br>Fixed reset and cat-related bugs that could end up in negative mpc</p>
        <p>v0.4.0<br>Added the first set of cat adoption!</p>
        <p>v0.3.7<br>More NaN related bugfixes</p>
        <p>v0.3.6<br>Bugfixes with new games creating NaN-types, started to add backend support for next major update, code modularization</p>
        <p>v0.3.5<br>Bugfixes with mpc3 button</p>
        <p>v0.3.4<br>Adjusted css - now it looks better</p>
        <p>v0.3.3<br>Added another mpc upgrade button, fixed some bugs with saving, compressed text updating</p>
        <p>v0.3.2<br>Added the changelog to the main site (it was held on a .txt file on my computer)</p>
        <p>v0.3.1<br>Fixed bug where resetting with max purchases and refreshing made you unable to purchase anything</p>
        <p>v0.3.0<br>Added shop!!!</p>
        <p>v0.2.1<br>Added 'buy cat' button..... hmm what will it do</p>
        <p>v0.2.0<br>Added autosaving</p>
        <p>v0.1.2<br>Fixed various bugs relating to the reset button</p>
        <p>v0.1.1<br>Added Reset button</p>
        <p>v0.1.0<br>Created the game. Its just a button, and a number</p>
      </div>
    </main>
    <footer>
      <a href="https://www.youtube.com/@mangokittengaming">YouTube</a>
      <a href="https://www.twitch.tv/mangokittengaming">Twitch</a>
      <a href="https://steamcommunity.com/profiles/76561199415611477/">Steam</a>
    </footer>
  </body>
</html>
<script src="scripts/cats.js"></script>
