<!DOCTYPE html>
<html>
  <head>
    <title>MangoKitten Clicker</title>
      <link rel="stylesheet" href="../style.css">
      <link rel="preconnect" href="https://fonts.googleapis.com">
      <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
      <link href="https://fonts.googleapis.com/css2?family=Playpen+Sans&display=swap" rel="stylesheet">
      <link rel="icon" type="image/x-icon" href="../img/favicon.ico">
  </head>
  <body onload="autoload()">
    <header>
      <p class="spacer">&#10240</p>
      <h1>MangoKitten</h1>
      <p class="spacer">&#10240</p>
    </header>
    <main>
      <script>
        // preloading and restoration
        let dolor = parseInt(localStorage.getItem("money"));
        let mpc = parseInt(localStorage.getItem("mpc"));
        let bought = [0, 0, 0, 0];
        if (mpc == 1) {
          bought = [0, 0, 0, 0];
        } else {
          bought = localStorage.getItem("bought");
        }

        // define arrays for buying stuff
        let max = [1, 6, 0, 0];
        let costs = [2000, 50, 100, 2000];
        let itemprice = 0;

        if (!dolor) {
          dolor = 0;
          console.log("No save file found, starting fresh.")
        }
        if (!mpc) {
          mpc = 1;
        }
        if (!bought) {
          bought = [0, 0, 0, 0];
        }

        // continue preload once html elements exist
        function autoload() {
          document.getElementById("moneydisp").innerHTML = `Money: ${String(dolor)}`
          document.getElementById("mpcdisp").innerHTML = `Money: per Click ${String(mpc)}`
          console.log("Loaded")
        }

        // get money
        function money() {
          dolor = dolor + mpc
          document.getElementById("moneydisp").innerHTML = `Money: ${String(dolor)}`
        }
        // manual save
        function localsave() {
          localStorage.setItem("money", dolor);
          localStorage.setItem("mpc", mpc);
          localStorage.setItem("bought", bought);
          var now = new Date();
          var datetime = now.toLocaleString();
          document.getElementById("lastsaved").innerHTML = `Last Saved: ${String(datetime)}`
          console.log("Saved")
        }
        // manual load
        function localload() {
          let dolor = parseInt(localStorage.getItem("money"));
          document.getElementById("moneydisp").innerHTML = `Money: ${String(dolor)}`
          let mpc = parseInt(localStorage.getItem("mpc"));
          document.getElementById("mpcdisp").innerHTML = `Money per Click: ${String(mpc)}`
          let bought = localStorage.getItem("bought");
          console.log("Loaded")
        }
        // manual hard reset
        function resetstorage() {
          dolor = 0;
          localStorage.setItem("money", dolor);
          mpc = 1;
          localStorage.setItem("mpc", mpc);
          bought = [0, 0, 0, 0];
          localStorage.setItem("bought", bought);
          document.getElementById("moneydisp").innerHTML = `Money: ${String(dolor)}`
          document.getElementById("mpcdisp").innerHTML = `Money per Click: ${String(mpc)}`
        }

        // buy an item off the above arrays
        function buyitem(id) {
          itemprice = costs[id];
          itemqty = bought[id];
          itemmax = max[id];
          if (itemqty < itemmax) {
            if (dolor >= itemprice) {
              dolor = dolor-itemprice;
              document.getElementById("moneydisp").innerHTML = `Money: ${String(dolor)}`
              if (id == 0) {
                document.getElementById("money").innerHTML = `Get Money üêà`
              } else if (id == 1) {
                mpc = mpc + 0.5;
                bought.splice(1, 1, itemqty+1)
                document.getElementById("mpcdisp").innerHTML = `Money per Click: ${String(mpc)}`
              }
              document.getElementById("clickerinfo").innerHTML = "---"
              // bought item
            } else {
              // too poor
              document.getElementById("clickerinfo").innerHTML = "You're too poor!"
            };
          } else {
            document.getElementById("clickerinfo").innerHTML = "You already have the max!"
          }
        };
        
        // autosave
        setInterval(function() {
          localStorage.setItem("money", dolor);
          localStorage.setItem("mpc", mpc);
          localStorage.setItem("bought", bought);
          var now = new Date();
          var datetime = now.toLocaleString();
          document.getElementById("lastsaved").innerHTML = `Last Saved: ${String(datetime)}`
          console.log("Auto-saved")
        }, 60 * 1000);
      </script>
      <div class="spacer">
        <p>&#10240</p>
      </div>
      <p id="clickertopbar">Mangos Clicker Game v0.3</p>
      <p id="clickerinfo">---</p>
      <h2 id="moneydisp">Money: 0</h2>
      <p id="mpcdisp">Money per Click: 1</p>
      <button onclick="money()" class="moneybutton" id="money">Get Money</button>
      <button onclick="localsave()" class="savebutton">Save</button>
      <button onclick="localload()" class="savebutton">Load</button>
      <button onclick="resetstorage()" class="savebutton">Reset</button>
      <p id="lastsaved">Last Saved: Not saved this session.</p>
      <button onclick="buyitem(0)" class="moneybutton">Buy a Cat $2000</button>
      <button onclick="buyitem(1)" class="moneybutton">Increase mpc $50</button>
    </main>
    <footer>
      <a href="https://www.youtube.com/@mangokittengaming">YouTube</a>
      <a href="https://www.twitch.tv/mangokittengaming">Twitch</a>
      <a href="https://steamcommunity.com/profiles/76561199415611477/">Steam</a>
    </footer>
  </body>
</html>
